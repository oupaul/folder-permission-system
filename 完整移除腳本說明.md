# å®Œæ•´ç§»é™¤è…³æœ¬èªªæ˜æ–‡æª”

## ğŸ“‹ æ¦‚è¿°

`uninstall.sh` æ˜¯ä¸€å€‹å®‰å…¨ã€å®Œæ•´çš„æ‡‰ç”¨ç¨‹å¼ç§»é™¤è…³æœ¬ï¼Œæä¾›ä¸‰ç¨®ç§»é™¤æ¨¡å¼ï¼Œç¢ºä¿åœ¨å¸è¼‰æ‡‰ç”¨æ™‚èƒ½å¤ æ ¹æ“šéœ€æ±‚é¸æ“‡æœ€åˆé©çš„æ–¹å¼ã€‚

---

## ğŸ¯ ä¸»è¦åŠŸèƒ½

### ä¸‰ç¨®ç§»é™¤æ¨¡å¼

1. **å®Œå…¨ç§»é™¤æ¨¡å¼**ï¼ˆåˆªé™¤æ‰€æœ‰æª”æ¡ˆï¼‰
   - åˆªé™¤æ‡‰ç”¨ç¨‹å¼ç›®éŒ„åŠæ‰€æœ‰å…§å®¹
   - åˆªé™¤æ‰€æœ‰è³‡æ–™åº«æª”æ¡ˆ
   - åˆªé™¤ä¸Šå‚³æª”æ¡ˆã€æ—¥èªŒã€å‚™ä»½
   - åœæ­¢ä¸¦ç§»é™¤ PM2 é€²ç¨‹
   - é‡‹æ”¾ä½”ç”¨ç«¯å£

2. **ä¿ç•™è³‡æ–™ç§»é™¤æ¨¡å¼**ï¼ˆå…ˆå‚™ä»½å†åˆªé™¤ï¼‰
   - è‡ªå‹•å‚™ä»½è³‡æ–™åº«æª”æ¡ˆ
   - è‡ªå‹•å‚™ä»½ä¸Šå‚³æª”æ¡ˆ
   - è‡ªå‹•å‚™ä»½é…ç½®æª”æ¡ˆ
   - ç„¶å¾ŒåŸ·è¡Œå®Œæ•´ç§»é™¤
   - æä¾›æ¢å¾©æŒ‡å¼•

3. **åƒ…åœæ­¢æœå‹™æ¨¡å¼**ï¼ˆä¸åˆªé™¤æª”æ¡ˆï¼‰
   - åœæ­¢ PM2 é€²ç¨‹
   - é‡‹æ”¾ä½”ç”¨ç«¯å£
   - ä¿ç•™æ‰€æœ‰æª”æ¡ˆå’Œè³‡æ–™
   - æ–¹ä¾¿æ—¥å¾Œé‡æ–°å•Ÿå‹•

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨

```bash
# 1. ç¢ºä¿è…³æœ¬æœ‰åŸ·è¡Œæ¬Šé™
chmod +x uninstall.sh

# 2. ä½¿ç”¨ sudo åŸ·è¡Œï¼ˆéœ€è¦ç®¡ç†å“¡æ¬Šé™ï¼‰
sudo ./uninstall.sh

# 3. æŒ‰ç…§æç¤ºé¸æ“‡ç§»é™¤æ¨¡å¼
```

### åŸ·è¡Œæµç¨‹

```
å•Ÿå‹•è…³æœ¬
    â†“
æ¬Šé™æª¢æŸ¥ï¼ˆéœ€è¦ sudoï¼‰
    â†“
é¡¯ç¤ºç•¶å‰å®‰è£ç‹€æ…‹
  - æ‡‰ç”¨ç›®éŒ„å¤§å°
  - è³‡æ–™åº«æ•¸é‡
  - å‚™ä»½æ•¸é‡
  - PM2 é€²ç¨‹ç‹€æ…‹
    â†“
é¸æ“‡ç§»é™¤æ¨¡å¼
  [1] å®Œå…¨ç§»é™¤
  [2] ä¿ç•™è³‡æ–™ç§»é™¤
  [3] åƒ…åœæ­¢æœå‹™
  [4] å–æ¶ˆæ“ä½œ
    â†“
ç¢ºèªæ“ä½œ
    â†“
åœæ­¢ PM2 æœå‹™
    â†“
å‚™ä»½è³‡æ–™ï¼ˆå¦‚é¸æ“‡æ¨¡å¼ 2ï¼‰
    â†“
ç§»é™¤æ‡‰ç”¨æª”æ¡ˆï¼ˆæ¨¡å¼ 1ã€2ï¼‰
    â†“
æ¸…ç†å’Œé©—è­‰
    â†“
é¡¯ç¤ºå®Œæˆç¸½çµ
```

---

## ğŸ“Š å„æ¨¡å¼è©³ç´°èªªæ˜

### æ¨¡å¼ 1: å®Œå…¨ç§»é™¤ ğŸ—‘ï¸

**é©ç”¨å ´æ™¯ï¼š**
- å®Œå…¨ä¸å†éœ€è¦æ­¤æ‡‰ç”¨
- ç¢ºå®šä¸éœ€è¦ä¿ç•™ä»»ä½•è³‡æ–™
- æº–å‚™å…¨æ–°å®‰è£
- æ¸…ç†æ¸¬è©¦ç’°å¢ƒ

**æ“ä½œå…§å®¹ï¼š**
```bash
âœ… åœæ­¢ PM2 é€²ç¨‹
âœ… å¾ PM2 ä¸­åˆªé™¤æ‡‰ç”¨
âœ… é‡‹æ”¾æ‰€æœ‰ä½”ç”¨ç«¯å£
âœ… åˆªé™¤ /opt/folder_permission_system ç›®éŒ„
âœ… åˆªé™¤æ‰€æœ‰å­ç›®éŒ„å’Œæª”æ¡ˆï¼š
   - databases/    ï¼ˆè³‡æ–™åº«ï¼‰
   - uploads/      ï¼ˆä¸Šå‚³æª”æ¡ˆï¼‰
   - logs/         ï¼ˆæ—¥èªŒï¼‰
   - backups/      ï¼ˆå‚™ä»½ï¼‰
   - public/       ï¼ˆéœæ…‹æª”æ¡ˆï¼‰
   - node_modules/ ï¼ˆä¾è³´å¥—ä»¶ï¼‰
   - æ‰€æœ‰é…ç½®æª”æ¡ˆ
```

**ç¢ºèªæç¤ºï¼š**
```
âš ï¸  æ³¨æ„ï¼šé¸æ“‡å®Œå…¨ç§»é™¤å°‡åˆªé™¤æ‰€æœ‰è³‡æ–™ï¼ŒåŒ…æ‹¬ï¼š
  - æ‡‰ç”¨ç¨‹å¼æª”æ¡ˆ
  - æ‰€æœ‰è³‡æ–™åº«æª”æ¡ˆ
  - ä¸Šå‚³çš„æª”æ¡ˆ
  - æ—¥èªŒæª”æ¡ˆ
  - å‚™ä»½æª”æ¡ˆ

ç¢ºå®šè¦å®Œå…¨ç§»é™¤å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼ [y/N]: 

é€™æ˜¯æœ€å¾Œä¸€æ¬¡ç¢ºèªï¼
çœŸçš„è¦åˆªé™¤ /opt/folder_permission_system åŠå…¶æ‰€æœ‰å…§å®¹å—ï¼Ÿ [y/N]: 
```

**åŸ·è¡Œçµæœï¼š**
```
âœ… æ‡‰ç”¨ç¨‹å¼å·²å®Œå…¨ç§»é™¤

å·²åˆªé™¤ï¼š
  - æ‡‰ç”¨ç¨‹å¼ç›®éŒ„ï¼š/opt/folder_permission_system
  - PM2 é€²ç¨‹ï¼šfolder-permission-system
  - æ‰€æœ‰è³‡æ–™åº«
  - æ‰€æœ‰å‚™ä»½
```

---

### æ¨¡å¼ 2: ä¿ç•™è³‡æ–™ç§»é™¤ ğŸ’¾

**é©ç”¨å ´æ™¯ï¼š**
- éœ€è¦ç§»é™¤æ‡‰ç”¨ä½†ä¿ç•™è³‡æ–™
- æº–å‚™å‡ç´šæˆ–é·ç§»
- æƒ³è¦ä¿ç•™è³‡æ–™åº«ä½œç‚ºå‚™ä»½
- å¯èƒ½éœ€è¦æ¢å¾©è³‡æ–™

**æ“ä½œå…§å®¹ï¼š**
```bash
âœ… åœæ­¢ PM2 é€²ç¨‹
âœ… å‰µå»ºå‚™ä»½ç›®éŒ„ï¼ˆå¸¶æ™‚é–“æˆ³ï¼‰
âœ… å‚™ä»½é‡è¦è³‡æ–™ï¼š
   - databases/         â†’ å‚™ä»½ç›®éŒ„
   - uploads/           â†’ å‚™ä»½ç›®éŒ„
   - package.json       â†’ å‚™ä»½ç›®éŒ„
   - ecosystem.config.js â†’ å‚™ä»½ç›®éŒ„
   - .env               â†’ å‚™ä»½ç›®éŒ„
âœ… å‰µå»ºå‚™ä»½è³‡è¨Šæª”æ¡ˆ
âœ… åˆªé™¤æ‡‰ç”¨ç¨‹å¼ç›®éŒ„
âœ… é‡‹æ”¾æ‰€æœ‰ä½”ç”¨ç«¯å£
```

**å‚™ä»½ä½ç½®ï¼š**
```
/opt/backups/uninstall_20251110_143025/
â”œâ”€â”€ databases/
â”‚   â”œâ”€â”€ system.db
â”‚   â”œâ”€â”€ admin.db
â”‚   â””â”€â”€ user_*.db
â”œâ”€â”€ uploads/
â”‚   â””â”€â”€ (ä¸Šå‚³çš„æª”æ¡ˆ)
â”œâ”€â”€ package.json
â”œâ”€â”€ ecosystem.config.js
â”œâ”€â”€ .env
â””â”€â”€ backup_info.txt
```

**åŸ·è¡Œçµæœï¼š**
```
âœ… æ‡‰ç”¨ç¨‹å¼å·²ç§»é™¤ï¼ˆè³‡æ–™å·²å‚™ä»½ï¼‰

å·²åˆªé™¤ï¼š
  - æ‡‰ç”¨ç¨‹å¼ç›®éŒ„ï¼š/opt/folder_permission_system
  - PM2 é€²ç¨‹ï¼šfolder-permission-system

å‚™ä»½ä½ç½®ï¼š
  ğŸ“ /opt/backups/uninstall_20251110_143025

å‚™ä»½å…§å®¹ï¼š
  - databases/  ï¼ˆè³‡æ–™åº«æª”æ¡ˆï¼‰
  - uploads/    ï¼ˆä¸Šå‚³æª”æ¡ˆï¼‰
  - *.json      ï¼ˆé…ç½®æª”æ¡ˆï¼‰
```

**æ¢å¾©è³‡æ–™æ–¹æ³•ï¼š**
```bash
# 1. é‡æ–°éƒ¨ç½²æ‡‰ç”¨
./deploy.sh

# 2. æ¢å¾©è³‡æ–™åº«
BACKUP_DIR="/opt/backups/uninstall_20251110_143025"
sudo cp -r $BACKUP_DIR/databases/* /opt/folder_permission_system/databases/

# 3. ä¿®å¾©æ¬Šé™
sudo chown -R $USER:$USER /opt/folder_permission_system/databases
sudo chmod -R 775 /opt/folder_permission_system/databases

# 4. é‡å•Ÿæœå‹™
pm2 restart folder-permission-system

# 5. é©—è­‰
pm2 logs folder-permission-system
curl http://localhost:5000
```

---

### æ¨¡å¼ 3: åƒ…åœæ­¢æœå‹™ ğŸ›‘

**é©ç”¨å ´æ™¯ï¼š**
- è‡¨æ™‚åœæ­¢æœå‹™é€²è¡Œç¶­è­·
- éœ€è¦ä¿®æ”¹é…ç½®æª”æ¡ˆ
- æš«æ™‚ä¸ä½¿ç”¨ä½†ä¸æƒ³åˆªé™¤
- é‡‹æ”¾ç³»çµ±è³‡æº

**æ“ä½œå…§å®¹ï¼š**
```bash
âœ… åœæ­¢ PM2 é€²ç¨‹
âœ… å¾ PM2 åˆ—è¡¨ä¸­åˆªé™¤
âœ… é‡‹æ”¾æ‰€æœ‰ä½”ç”¨ç«¯å£
âœ… ä¿ç•™æ‰€æœ‰æª”æ¡ˆå’Œç›®éŒ„
```

**åŸ·è¡Œçµæœï¼š**
```
âœ… æœå‹™å·²åœæ­¢

å·²åŸ·è¡Œï¼š
  - åœæ­¢ PM2 é€²ç¨‹ï¼šfolder-permission-system
  - é‡‹æ”¾ä½”ç”¨ç«¯å£

ä¿ç•™ï¼š
  - æ‡‰ç”¨ç¨‹å¼ç›®éŒ„ï¼š/opt/folder_permission_system
  - æ‰€æœ‰è³‡æ–™æª”æ¡ˆ
```

**é‡æ–°å•Ÿå‹•æ–¹æ³•ï¼š**
```bash
# æ–¹æ³• 1: ä½¿ç”¨ PM2
cd /opt/folder_permission_system
pm2 start ecosystem.config.js

# æ–¹æ³• 2: ä½¿ç”¨ Node.js ç›´æ¥å•Ÿå‹•
cd /opt/folder_permission_system
node app.js

# æ–¹æ³• 3: é‡æ–°åŸ·è¡Œéƒ¨ç½²è…³æœ¬ï¼ˆæœƒè‡ªå‹•å•Ÿå‹•ï¼‰
./deploy.sh

# æŸ¥çœ‹ç‹€æ…‹
pm2 status
pm2 logs folder-permission-system
```

---

## ğŸ” è…³æœ¬åŸ·è¡Œæ­¥é©Ÿè©³è§£

### æ­¥é©Ÿ 1: æ¬Šé™æª¢æŸ¥

```bash
if [ "$EUID" -ne 0 ]; then 
    echo "âŒ è«‹ä½¿ç”¨ sudo åŸ·è¡Œæ­¤è…³æœ¬"
    exit 1
fi
```

**ç‚ºä»€éº¼éœ€è¦ sudoï¼š**
- åˆªé™¤ `/opt/` ç›®éŒ„ä¸‹çš„æª”æ¡ˆ
- åœæ­¢ç³»çµ±æœå‹™
- çµ‚æ­¢å¯èƒ½ç”±å…¶ä»–ç”¨æˆ¶å•Ÿå‹•çš„é€²ç¨‹
- ä¿®æ”¹ç³»çµ±é…ç½®

---

### æ­¥é©Ÿ 2: æª¢æŸ¥ç•¶å‰å®‰è£ç‹€æ…‹

**é¡¯ç¤ºè³‡è¨Šï¼š**
```
âœ… æ‡‰ç”¨ç›®éŒ„å­˜åœ¨ï¼š/opt/folder_permission_system
  ç›®éŒ„å¤§å°ï¼š125M
  è³‡æ–™åº«æ•¸é‡ï¼š5 å€‹
  å‚™ä»½æ•¸é‡ï¼š3 å€‹

â„¹ï¸  PM2 å·²å®‰è£
  é€²ç¨‹ç‹€æ…‹ï¼šonline
```

**æª¢æŸ¥é …ç›®ï¼š**
1. æ‡‰ç”¨ç›®éŒ„æ˜¯å¦å­˜åœ¨
2. ç›®éŒ„ç¸½å¤§å°
3. è³‡æ–™åº«æª”æ¡ˆæ•¸é‡
4. å‚™ä»½æª”æ¡ˆæ•¸é‡
5. PM2 æ˜¯å¦å®‰è£
6. PM2 é€²ç¨‹ç‹€æ…‹

---

### æ­¥é©Ÿ 3: é¸æ“‡ç§»é™¤é¸é …

**äº’å‹•é¸å–®ï¼š**
```
è«‹é¸æ“‡è¦åŸ·è¡Œçš„æ“ä½œï¼š

1. ğŸ—‘ï¸  å®Œå…¨ç§»é™¤ï¼ˆåˆªé™¤æ‰€æœ‰æª”æ¡ˆï¼ŒåŒ…æ‹¬è³‡æ–™åº«ï¼‰
2. ğŸ’¾ ä¿ç•™è³‡æ–™ç§»é™¤ï¼ˆå‚™ä»½è³‡æ–™åº«å¾Œå†åˆªé™¤æ‡‰ç”¨ï¼‰
3. ğŸ›‘ åƒ…åœæ­¢æœå‹™ï¼ˆä¸åˆªé™¤ä»»ä½•æª”æ¡ˆï¼‰
4. âŒ å–æ¶ˆæ“ä½œ

è«‹é¸æ“‡ [1-4]: 
```

**å¤šé‡ç¢ºèªæ©Ÿåˆ¶ï¼š**
- ç¬¬ä¸€æ¬¡ï¼šé¸æ“‡æ“ä½œæ¨¡å¼
- ç¬¬äºŒæ¬¡ï¼šç¢ºèªåŸ·è¡Œè©²æ¨¡å¼
- ç¬¬ä¸‰æ¬¡ï¼ˆåƒ…å®Œå…¨ç§»é™¤ï¼‰ï¼šæœ€å¾Œç¢ºèª

---

### æ­¥é©Ÿ 4: åœæ­¢ PM2 æœå‹™

**åŸ·è¡Œæ“ä½œï¼š**
```bash
pm2 stop folder-permission-system
pm2 delete folder-permission-system
pm2 save --force
```

**ç«¯å£æª¢æŸ¥å’Œæ¸…ç†ï¼š**
```
æª¢æŸ¥ç«¯å£ä½”ç”¨...
ç«¯å£ 3000: æœªä½”ç”¨ âœ…
ç«¯å£ 5000: è¢«ä½”ç”¨ âš ï¸

æ˜¯å¦å¼·åˆ¶çµ‚æ­¢ä½”ç”¨ç«¯å£ 5000 çš„é€²ç¨‹ï¼Ÿ [y/N]: y
âœ… å·²çµ‚æ­¢ç«¯å£ 5000 çš„é€²ç¨‹
```

---

### æ­¥é©Ÿ 5: å‚™ä»½è³‡æ–™ï¼ˆæ¨¡å¼ 2ï¼‰

**å‚™ä»½å…§å®¹ï¼š**
```
å‰µå»ºå‚™ä»½ç›®éŒ„...
âœ… å‚™ä»½ç›®éŒ„ï¼š/opt/backups/uninstall_20251110_143025

å‚™ä»½è³‡æ–™åº«...
âœ… è³‡æ–™åº«å·²å‚™ä»½ï¼ˆ45Mï¼‰

å‚™ä»½ä¸Šå‚³æª”æ¡ˆ...
âœ… ä¸Šå‚³æª”æ¡ˆå·²å‚™ä»½ï¼ˆ12Mï¼‰

å‚™ä»½é…ç½®æª”æ¡ˆ...
âœ… é…ç½®æª”æ¡ˆå·²å‚™ä»½

âœ… å‚™ä»½å®Œæˆ
```

**å‚™ä»½è³‡è¨Šæª”æ¡ˆå…§å®¹ï¼š**
```
å‚™ä»½è³‡è¨Š
========================================
å‚™ä»½æ™‚é–“ï¼š2025-11-10 14:30:25
åŸå§‹è·¯å¾‘ï¼š/opt/folder_permission_system
å‚™ä»½åŸå› ï¼šæ‡‰ç”¨ç¨‹å¼ç§»é™¤å‰è‡ªå‹•å‚™ä»½
ç³»çµ±è³‡è¨Šï¼šLinux foldersvr 5.15.0-78-generic
========================================

ç›®éŒ„çµæ§‹ï¼š
/opt/backups/uninstall_20251110_143025
â”œâ”€â”€ databases
â”œâ”€â”€ uploads
â”œâ”€â”€ package.json
â”œâ”€â”€ ecosystem.config.js
â””â”€â”€ backup_info.txt

å‚™ä»½å¤§å°ï¼š
57M    /opt/backups/uninstall_20251110_143025
```

---

### æ­¥é©Ÿ 6: ç§»é™¤æ‡‰ç”¨æª”æ¡ˆ

**åˆªé™¤éç¨‹ï¼š**
```
æº–å‚™åˆªé™¤ï¼š/opt/folder_permission_system

åˆªé™¤ä¸­...
..........

âœ… æ‡‰ç”¨ç›®éŒ„å·²åˆªé™¤
```

**é€²åº¦é¡¯ç¤ºï¼š**
- ä½¿ç”¨èƒŒæ™¯é€²ç¨‹åŸ·è¡Œåˆªé™¤
- é¡¯ç¤ºå‹•æ…‹é€²åº¦é»
- ç­‰å¾…å®Œæˆå¾Œç¢ºèª

---

### æ­¥é©Ÿ 7: æ¸…ç†å’Œé©—è­‰

**é©—è­‰é …ç›®ï¼š**
```bash
# 1. é©—è­‰ç›®éŒ„åˆªé™¤
if [ -d "$APP_DIR" ]; then
    echo "âš ï¸  è­¦å‘Šï¼šæ‡‰ç”¨ç›®éŒ„ä»ç„¶å­˜åœ¨"
else
    echo "âœ… æ‡‰ç”¨ç›®éŒ„å·²å®Œå…¨ç§»é™¤"
fi

# 2. é©—è­‰ PM2 é€²ç¨‹
if pm2 list | grep -q "$APP_NAME"; then
    echo "âš ï¸  è­¦å‘Šï¼šPM2 ä¸­ä»æœ‰æ‡‰ç”¨é€²ç¨‹"
else
    echo "âœ… PM2 ä¸­ç„¡æ®˜ç•™é€²ç¨‹"
fi

# 3. é©—è­‰ç«¯å£é‡‹æ”¾
for PORT in "${PORTS[@]}"; do
    if lsof -ti:$PORT &> /dev/null; then
        echo "âš ï¸  ç«¯å£ $PORT ä»è¢«ä½”ç”¨"
    fi
done
```

---

## ğŸ“‹ å®Œæˆç¸½çµç¯„ä¾‹

### å®Œå…¨ç§»é™¤æ¨¡å¼

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… ç§»é™¤å®Œæˆï¼

âœ… æ‡‰ç”¨ç¨‹å¼å·²å®Œå…¨ç§»é™¤

å·²åˆªé™¤ï¼š
  - æ‡‰ç”¨ç¨‹å¼ç›®éŒ„ï¼š/opt/folder_permission_system
  - PM2 é€²ç¨‹ï¼šfolder-permission-system
  - æ‰€æœ‰è³‡æ–™åº«
  - æ‰€æœ‰å‚™ä»½

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ å¾ŒçºŒå»ºè­°ï¼š

1. æª¢æŸ¥ç£ç¢Ÿç©ºé–“ï¼š
   df -h

4. å¦‚éœ€é‡æ–°å®‰è£ï¼š
   ./deploy.sh

5. æŸ¥çœ‹ç³»çµ±è³‡æºï¼š
   pm2 list
   free -h
   df -h
```

### ä¿ç•™è³‡æ–™ç§»é™¤æ¨¡å¼

```
âœ… æ‡‰ç”¨ç¨‹å¼å·²ç§»é™¤ï¼ˆè³‡æ–™å·²å‚™ä»½ï¼‰

å·²åˆªé™¤ï¼š
  - æ‡‰ç”¨ç¨‹å¼ç›®éŒ„ï¼š/opt/folder_permission_system
  - PM2 é€²ç¨‹ï¼šfolder-permission-system

å‚™ä»½ä½ç½®ï¼š
  ğŸ“ /opt/backups/uninstall_20251110_143025

å‚™ä»½å…§å®¹ï¼š
  - databases/  ï¼ˆè³‡æ–™åº«æª”æ¡ˆï¼‰
  - uploads/    ï¼ˆä¸Šå‚³æª”æ¡ˆï¼‰
  - *.json      ï¼ˆé…ç½®æª”æ¡ˆï¼‰

â„¹ï¸  å¦‚éœ€æ¢å¾©è³‡æ–™ï¼Œè«‹å¾å‚™ä»½ç›®éŒ„è¤‡è£½

3. å¦‚éœ€æ¢å¾©è³‡æ–™ï¼š
   # é‡æ–°éƒ¨ç½²æ‡‰ç”¨
   ./deploy.sh
   # æ¢å¾©è³‡æ–™åº«
   cp -r /opt/backups/uninstall_20251110_143025/databases/* /opt/folder_permission_system/databases/
   # ä¿®å¾©æ¬Šé™
   sudo chown -R $USER:$USER /opt/folder_permission_system/databases
   sudo chmod -R 775 /opt/folder_permission_system/databases
   # é‡å•Ÿæœå‹™
   pm2 restart folder-permission-system
```

### åƒ…åœæ­¢æœå‹™æ¨¡å¼

```
âœ… æœå‹™å·²åœæ­¢

å·²åŸ·è¡Œï¼š
  - åœæ­¢ PM2 é€²ç¨‹ï¼šfolder-permission-system
  - é‡‹æ”¾ä½”ç”¨ç«¯å£

ä¿ç•™ï¼š
  - æ‡‰ç”¨ç¨‹å¼ç›®éŒ„ï¼š/opt/folder_permission_system
  - æ‰€æœ‰è³‡æ–™æª”æ¡ˆ

â„¹ï¸  å¦‚éœ€é‡æ–°å•Ÿå‹•ï¼Œè«‹åŸ·è¡Œï¼š
  cd /opt/folder_permission_system && pm2 start ecosystem.config.js

1. é‡æ–°å•Ÿå‹•æœå‹™ï¼š
   cd /opt/folder_permission_system
   pm2 start ecosystem.config.js

2. æŸ¥çœ‹æœå‹™ç‹€æ…‹ï¼š
   pm2 status
   pm2 logs folder-permission-system
```

---

## ğŸ”§ æŠ€è¡“ç´°ç¯€

### é…ç½®è®Šæ•¸

```bash
APP_NAME="folder-permission-system"        # PM2 é€²ç¨‹åç¨±
APP_DIR="/opt/folder_permission_system"    # æ‡‰ç”¨å®‰è£ç›®éŒ„
BACKUP_BASE_DIR="/opt/backups"             # å‚™ä»½åŸºç¤ç›®éŒ„
BACKUP_DIR="$BACKUP_BASE_DIR/uninstall_$(date +%Y%m%d_%H%M%S)"  # å‚™ä»½ç›®éŒ„ï¼ˆå¸¶æ™‚é–“æˆ³ï¼‰
```

### é¡è‰²å®šç¾©

```bash
RED='\033[0;31m'      # éŒ¯èª¤ã€è­¦å‘Š
GREEN='\033[0;32m'    # æˆåŠŸ
YELLOW='\033[1;33m'   # è­¦å‘Š
BLUE='\033[0;34m'     # è³‡è¨Š
CYAN='\033[0;36m'     # æ¨™é¡Œ
NC='\033[0m'          # ç„¡é¡è‰²
```

### å·¥å…·å‡½æ•¸

| å‡½æ•¸åç¨± | ç”¨é€” | ç¯„ä¾‹ |
|---------|------|------|
| `print_header()` | é¡¯ç¤ºå€æ®µæ¨™é¡Œ | `print_header "æ­¥é©Ÿ 1/7"` |
| `print_success()` | é¡¯ç¤ºæˆåŠŸè¨Šæ¯ | `print_success "æ“ä½œå®Œæˆ"` |
| `print_warning()` | é¡¯ç¤ºè­¦å‘Šè¨Šæ¯ | `print_warning "æ³¨æ„"` |
| `print_error()` | é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ | `print_error "å¤±æ•—"` |
| `print_info()` | é¡¯ç¤ºè³‡è¨Šè¨Šæ¯ | `print_info "æç¤º"` |
| `confirm_action()` | ç¢ºèªå°è©±æ¡† | `confirm_action "ç¢ºå®šï¼Ÿ"` |

---

## âš ï¸ å®‰å…¨æ©Ÿåˆ¶

### 1. å¤šé‡ç¢ºèª

**å®Œå…¨ç§»é™¤éœ€è¦ 3 æ¬¡ç¢ºèªï¼š**
```bash
# ç¬¬ä¸€æ¬¡ï¼šé¸æ“‡æ“ä½œ
è«‹é¸æ“‡ [1-4]: 1

# ç¬¬äºŒæ¬¡ï¼šæ¨¡å¼ç¢ºèª
ç¢ºå®šè¦å®Œå…¨ç§»é™¤å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼ [y/N]: y

# ç¬¬ä¸‰æ¬¡ï¼šæœ€å¾Œç¢ºèª
é€™æ˜¯æœ€å¾Œä¸€æ¬¡ç¢ºèªï¼
çœŸçš„è¦åˆªé™¤ /opt/folder_permission_system åŠå…¶æ‰€æœ‰å…§å®¹å—ï¼Ÿ [y/N]: y
```

### 2. æ¬Šé™æª¢æŸ¥

```bash
# å¿…é ˆä½¿ç”¨ sudo
if [ "$EUID" -ne 0 ]; then 
    print_error "è«‹ä½¿ç”¨ sudo åŸ·è¡Œæ­¤è…³æœ¬"
    exit 1
fi
```

### 3. ç‹€æ…‹é©—è­‰

```bash
# æ“ä½œå‰é¡¯ç¤ºç•¶å‰ç‹€æ…‹
- ç›®éŒ„å¤§å°
- è³‡æ–™åº«æ•¸é‡
- å‚™ä»½æ•¸é‡
- é€²ç¨‹ç‹€æ…‹

# æ“ä½œå¾Œé©—è­‰çµæœ
- ç›®éŒ„æ˜¯å¦åˆªé™¤
- é€²ç¨‹æ˜¯å¦åœæ­¢
- ç«¯å£æ˜¯å¦é‡‹æ”¾
```

### 4. éŒ¯èª¤è™•ç†

```bash
set -e  # é‡åˆ°éŒ¯èª¤ç«‹å³åœæ­¢

# ä½†åœ¨æŸäº›å‘½ä»¤ä¸­ä½¿ç”¨å®¹éŒ¯è™•ç†
command 2>/dev/null || true
```

### 5. å‚™ä»½ä¿è­·

- æ¨¡å¼ 2 è‡ªå‹•å‚™ä»½é‡è¦è³‡æ–™
- å‰µå»ºå¸¶æ™‚é–“æˆ³çš„å‚™ä»½ç›®éŒ„
- ç”Ÿæˆå‚™ä»½è³‡è¨Šæª”æ¡ˆ
- ä¸æœƒè¦†è“‹ç¾æœ‰å‚™ä»½

---

## ğŸ“Š æ—¥èªŒè¨˜éŒ„

### æ—¥èªŒä½ç½®
```
/var/log/folder-permission-system-uninstall.log
```

### æ—¥èªŒå…§å®¹
```
æ‡‰ç”¨ç¨‹å¼ç§»é™¤æ—¥èªŒ
================================
ç§»é™¤æ™‚é–“ï¼š2025-11-10 14:30:45
ç§»é™¤æ¨¡å¼ï¼šbackup
åŸ·è¡Œç”¨æˆ¶ï¼šroot
æ‡‰ç”¨ç›®éŒ„ï¼š/opt/folder_permission_system
å‚™ä»½ç›®éŒ„ï¼š/opt/backups/uninstall_20251110_143025
================================
```

---

## ğŸ§ª æ¸¬è©¦æ¡ˆä¾‹

### æ¸¬è©¦ 1: å®Œå…¨ç§»é™¤

```bash
# æº–å‚™
sudo ./deploy.sh                    # å…ˆéƒ¨ç½²æ‡‰ç”¨
pm2 status                          # ç¢ºèªé‹è¡Œä¸­
ls -lh /opt/folder_permission_system

# åŸ·è¡Œ
sudo ./uninstall.sh
# é¸æ“‡ï¼š1ï¼ˆå®Œå…¨ç§»é™¤ï¼‰
# ç¢ºèªï¼šy, y

# é©—è­‰
ls /opt/folder_permission_system    # æ‡‰è©²ä¸å­˜åœ¨
pm2 list | grep folder              # æ‡‰è©²æ²’æœ‰é€²ç¨‹
lsof -i:5000                        # æ‡‰è©²æ²’æœ‰ä½”ç”¨
```

**é æœŸçµæœï¼š**
- âœ… ç›®éŒ„ä¸å­˜åœ¨
- âœ… PM2 ç„¡é€²ç¨‹
- âœ… ç«¯å£å·²é‡‹æ”¾

---

### æ¸¬è©¦ 2: ä¿ç•™è³‡æ–™ç§»é™¤

```bash
# æº–å‚™
sudo ./deploy.sh
cd /opt/folder_permission_system
# å‰µå»ºä¸€äº›æ¸¬è©¦è³‡æ–™
curl -X POST http://localhost:5000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username":"test","password":"test123"}'

# åŸ·è¡Œ
sudo ./uninstall.sh
# é¸æ“‡ï¼š2ï¼ˆä¿ç•™è³‡æ–™ç§»é™¤ï¼‰
# ç¢ºèªï¼šy

# é©—è­‰
ls /opt/folder_permission_system    # æ‡‰è©²ä¸å­˜åœ¨
ls /opt/backups/uninstall_*/        # æ‡‰è©²æœ‰å‚™ä»½
ls /opt/backups/uninstall_*/databases/*.db  # æ‡‰è©²æœ‰è³‡æ–™åº«

# æ¢å¾©æ¸¬è©¦
sudo ./deploy.sh
BACKUP=$(ls -td /opt/backups/uninstall_* | head -1)
sudo cp -r $BACKUP/databases/* /opt/folder_permission_system/databases/
sudo chown -R $USER:$USER /opt/folder_permission_system/databases
sudo chmod -R 775 /opt/folder_permission_system/databases
pm2 restart folder-permission-system
# é©—è­‰è³‡æ–™æ˜¯å¦æ¢å¾©
curl http://localhost:5000/api/auth/status
```

**é æœŸçµæœï¼š**
- âœ… æ‡‰ç”¨ç›®éŒ„å·²åˆªé™¤
- âœ… å‚™ä»½ç›®éŒ„å­˜åœ¨
- âœ… è³‡æ–™åº«å·²å‚™ä»½
- âœ… å¯ä»¥æˆåŠŸæ¢å¾©

---

### æ¸¬è©¦ 3: åƒ…åœæ­¢æœå‹™

```bash
# æº–å‚™
sudo ./deploy.sh
pm2 status                          # ç¢ºèªé‹è¡Œä¸­

# åŸ·è¡Œ
sudo ./uninstall.sh
# é¸æ“‡ï¼š3ï¼ˆåƒ…åœæ­¢æœå‹™ï¼‰
# ç¢ºèªï¼šy

# é©—è­‰
pm2 list | grep folder              # æ‡‰è©²æ²’æœ‰é€²ç¨‹
ls /opt/folder_permission_system    # æ‡‰è©²å­˜åœ¨
ls /opt/folder_permission_system/databases/*.db  # è³‡æ–™æ‡‰è©²å­˜åœ¨

# é‡å•Ÿæ¸¬è©¦
cd /opt/folder_permission_system
pm2 start ecosystem.config.js
pm2 status                          # æ‡‰è©²é‹è¡Œä¸­
curl http://localhost:5000          # æ‡‰è©²å¯ä»¥è¨ªå•
```

**é æœŸçµæœï¼š**
- âœ… é€²ç¨‹å·²åœæ­¢
- âœ… ç›®éŒ„ä»å­˜åœ¨
- âœ… è³‡æ–™å®Œæ•´
- âœ… å¯ä»¥é‡æ–°å•Ÿå‹•

---

## ğŸ’¡ å¸¸è¦‹å•é¡Œ

### Q1: åŸ·è¡Œæ™‚æç¤ºæ¬Šé™ä¸è¶³

**å•é¡Œï¼š**
```
âŒ è«‹ä½¿ç”¨ sudo åŸ·è¡Œæ­¤è…³æœ¬
```

**è§£æ±ºï¼š**
```bash
sudo ./uninstall.sh
```

---

### Q2: ç«¯å£ä»è¢«ä½”ç”¨

**å•é¡Œï¼š**
```
âš ï¸  ç«¯å£ 5000 ä»è¢«ä½”ç”¨
```

**è§£æ±ºï¼š**
```bash
# æ–¹æ³• 1: è…³æœ¬æœƒè©¢å•æ˜¯å¦å¼·åˆ¶çµ‚æ­¢
æ˜¯å¦å¼·åˆ¶çµ‚æ­¢ä½”ç”¨ç«¯å£ 5000 çš„é€²ç¨‹ï¼Ÿ [y/N]: y

# æ–¹æ³• 2: æ‰‹å‹•çµ‚æ­¢
lsof -ti:5000 | xargs kill -9
```

---

### Q3: PM2 é€²ç¨‹ç„¡æ³•åˆªé™¤

**å•é¡Œï¼š**
```
âš ï¸  è­¦å‘Šï¼šPM2 ä¸­ä»æœ‰æ‡‰ç”¨é€²ç¨‹
```

**è§£æ±ºï¼š**
```bash
# å¼·åˆ¶åˆªé™¤
pm2 delete folder-permission-system --force
pm2 kill
pm2 resurrect
```

---

### Q4: ç›®éŒ„åˆªé™¤å¤±æ•—

**å•é¡Œï¼š**
```
âš ï¸  è­¦å‘Šï¼šæ‡‰ç”¨ç›®éŒ„ä»ç„¶å­˜åœ¨
```

**è§£æ±ºï¼š**
```bash
# æª¢æŸ¥ä½”ç”¨
lsof +D /opt/folder_permission_system

# å¼·åˆ¶åˆªé™¤
sudo rm -rf /opt/folder_permission_system

# å¦‚æœä»ç„¡æ³•åˆªé™¤ï¼Œæª¢æŸ¥æª”æ¡ˆå±¬æ€§
sudo lsattr /opt/folder_permission_system
```

---

### Q5: æƒ³è¦æ¢å¾©å·²åˆªé™¤çš„è³‡æ–™

**å¦‚æœé¸æ“‡äº†æ¨¡å¼ 2ï¼ˆä¿ç•™è³‡æ–™ç§»é™¤ï¼‰ï¼š**
```bash
# 1. æŸ¥æ‰¾å‚™ä»½
ls -lt /opt/backups/uninstall_*

# 2. é¸æ“‡æœ€æ–°çš„å‚™ä»½
BACKUP="/opt/backups/uninstall_20251110_143025"

# 3. é‡æ–°éƒ¨ç½²æ‡‰ç”¨
sudo ./deploy.sh

# 4. æ¢å¾©è³‡æ–™
sudo cp -r $BACKUP/databases/* /opt/folder_permission_system/databases/
sudo chown -R $USER:$USER /opt/folder_permission_system/databases
sudo chmod -R 775 /opt/folder_permission_system/databases

# 5. é‡å•Ÿæœå‹™
pm2 restart folder-permission-system
```

**å¦‚æœé¸æ“‡äº†æ¨¡å¼ 1ï¼ˆå®Œå…¨ç§»é™¤ï¼‰ï¼š**
- âŒ ç„¡æ³•æ¢å¾©ï¼Œè³‡æ–™å·²æ°¸ä¹…åˆªé™¤
- ğŸ’¡ å»ºè­°ï¼šæ—¥å¾Œé¸æ“‡æ¨¡å¼ 2

---

### Q6: å¦‚ä½•æŸ¥çœ‹æ‰€æœ‰å‚™ä»½

```bash
# åˆ—å‡ºæ‰€æœ‰å¸è¼‰å‚™ä»½
ls -lth /opt/backups/uninstall_*

# æŸ¥çœ‹ç‰¹å®šå‚™ä»½çš„å…§å®¹
ls -lh /opt/backups/uninstall_20251110_143025/

# æŸ¥çœ‹å‚™ä»½è³‡è¨Š
cat /opt/backups/uninstall_20251110_143025/backup_info.txt

# è¨ˆç®—å‚™ä»½ç¸½å¤§å°
du -sh /opt/backups/
```

---

### Q7: å¦‚ä½•æ¸…ç†èˆŠå‚™ä»½

```bash
# åˆ—å‡ºæ‰€æœ‰å¸è¼‰å‚™ä»½ï¼ˆæŒ‰æ™‚é–“æ’åºï¼‰
ls -lt /opt/backups/uninstall_*/

# åˆªé™¤ç‰¹å®šå‚™ä»½
sudo rm -rf /opt/backups/uninstall_20251110_143025

# åªä¿ç•™æœ€æ–°çš„ 3 å€‹å‚™ä»½
cd /opt/backups
ls -t | grep uninstall_ | tail -n +4 | xargs -r sudo rm -rf

# åˆªé™¤ 30 å¤©å‰çš„å‚™ä»½
find /opt/backups -name "uninstall_*" -type d -mtime +30 -exec sudo rm -rf {} \;
```

---

## ğŸ”„ èˆ‡å…¶ä»–è…³æœ¬çš„æ•´åˆ

### èˆ‡ deploy.sh é…åˆ

```bash
# å®Œæ•´çš„é‡æ–°éƒ¨ç½²æµç¨‹
sudo ./uninstall.sh              # é¸æ“‡æ¨¡å¼ 2ï¼ˆä¿ç•™è³‡æ–™ï¼‰
sudo ./deploy.sh                 # é‡æ–°éƒ¨ç½²
# æ¢å¾©è³‡æ–™ï¼ˆå¦‚éœ€è¦ï¼‰
BACKUP=$(ls -td /opt/backups/uninstall_* | head -1)
sudo cp -r $BACKUP/databases/* /opt/folder_permission_system/databases/
sudo ./fix_db_permissions.sh
```

### èˆ‡ç¶­è­·è…³æœ¬é…åˆ

```bash
# åœæ­¢æœå‹™é€²è¡Œç¶­è­·
sudo ./uninstall.sh              # é¸æ“‡æ¨¡å¼ 3ï¼ˆåƒ…åœæ­¢ï¼‰
# åŸ·è¡Œç¶­è­·æ“ä½œ
cd /opt/folder_permission_system
# ä¿®æ”¹é…ç½®ã€æ¸…ç†æ—¥èªŒç­‰
# é‡æ–°å•Ÿå‹•
pm2 start ecosystem.config.js
```

---

## ğŸ“‹ æª¢æŸ¥æ¸…å–®

### ç§»é™¤å‰æª¢æŸ¥

- [ ] ç¢ºèªä¸å†éœ€è¦æ­¤æ‡‰ç”¨
- [ ] ç¢ºèªå·²å‚™ä»½é‡è¦è³‡æ–™ï¼ˆå¦‚é¸æ“‡å®Œå…¨ç§»é™¤ï¼‰
- [ ] ç¢ºèªæ²’æœ‰å…¶ä»–æœå‹™ä¾è³´æ­¤æ‡‰ç”¨
- [ ] ç¢ºèªæœ‰ sudo æ¬Šé™
- [ ] ç¢ºèªå‚™ä»½ç©ºé–“å……è¶³ï¼ˆå¦‚é¸æ“‡ä¿ç•™è³‡æ–™ç§»é™¤ï¼‰

### ç§»é™¤å¾Œæª¢æŸ¥

- [ ] æ‡‰ç”¨ç›®éŒ„å·²åˆªé™¤ï¼ˆæ¨¡å¼ 1ã€2ï¼‰
- [ ] PM2 é€²ç¨‹å·²åœæ­¢
- [ ] ç«¯å£å·²é‡‹æ”¾
- [ ] å‚™ä»½å·²å‰µå»ºï¼ˆæ¨¡å¼ 2ï¼‰
- [ ] æ—¥èªŒå·²è¨˜éŒ„
- [ ] ç³»çµ±è³‡æºå·²é‡‹æ”¾

---

## ğŸ“š ç›¸é—œæ–‡æª”

- `deploy.sh` - è‡ªå‹•éƒ¨ç½²è…³æœ¬
- `Ubuntuå®Œæ•´éƒ¨ç½²æŒ‡å—.md` - éƒ¨ç½²æŒ‡å—
- `ç³»çµ±ç¶­è­·ç®¡ç†æ‰‹å†Š.md` - ç¶­è­·æ‰‹å†Š
- `æ•…éšœæ’é™¤æ‰‹å†Š.md` - å•é¡Œæ’æŸ¥

---

## ğŸ‰ ç¸½çµ

**uninstall.sh ç‰¹é»ï¼š**
- âœ… ä¸‰ç¨®ç§»é™¤æ¨¡å¼ï¼Œéˆæ´»é¸æ“‡
- âœ… å¤šé‡ç¢ºèªæ©Ÿåˆ¶ï¼Œé˜²æ­¢èª¤æ“ä½œ
- âœ… è‡ªå‹•å‚™ä»½åŠŸèƒ½ï¼Œä¿è­·è³‡æ–™
- âœ… å®Œæ•´çš„ç‹€æ…‹æª¢æŸ¥å’Œé©—è­‰
- âœ… æ¸…æ™°çš„æ“ä½œæç¤ºå’Œçµæœé¡¯ç¤º
- âœ… è©³ç´°çš„æ—¥èªŒè¨˜éŒ„
- âœ… å®‰å…¨çš„éŒ¯èª¤è™•ç†
- âœ… å®¹æ˜“æ¢å¾©è³‡æ–™

**é©ç”¨å ´æ™¯ï¼š**
- ğŸ—‘ï¸  å®Œå…¨å¸è¼‰æ‡‰ç”¨
- ğŸ”„ é‡æ–°éƒ¨ç½²æ‡‰ç”¨
- ğŸ› ï¸  ç³»çµ±ç¶­è­·å’Œæ¸…ç†
- ğŸ’¾ é·ç§»åˆ°æ–°ç’°å¢ƒ
- ğŸ§ª æ¸¬è©¦ç’°å¢ƒæ¸…ç†

**å®‰å…¨ä¿éšœï¼š**
- ğŸ”’ å¤šé‡ç¢ºèªé˜²æ­¢èª¤åˆª
- ğŸ’¾ è‡ªå‹•å‚™ä»½ä¿è­·è³‡æ–™
- ğŸ“ è©³ç´°æ—¥èªŒå¯è¿½æº¯
- âœ… å®Œæ•´é©—è­‰ç¢ºä¿çµæœ

---

**æ–‡ä»¶ç‰ˆæœ¬ï¼š** v1.0  
**å‰µå»ºæ—¥æœŸï¼š** 2024å¹´11æœˆ  
**é©ç”¨è…³æœ¬ï¼š** uninstall.sh

