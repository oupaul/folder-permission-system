<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å…¥ - è³‡æ–™å¤¾æ¬Šé™ç®¡ç†ç³»çµ±</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons - ä½¿ç”¨ç©©å®šç‰ˆæœ¬å’Œ unpkg ä½œç‚ºå‚™ç”¨ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" onerror="this.onerror=null;this.href='https://unpkg.com/bootstrap-icons@1.10.0/font/bootstrap-icons.css'">
    <!-- Preload Bootstrap Icons Font -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/fonts/bootstrap-icons.woff2" as="font" type="font/woff2" crossorigin>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .login-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            max-width: 450px;
            width: 100%;
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .login-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .login-header h2 {
            margin: 0;
            font-weight: 600;
        }
        .login-header .icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        .login-body {
            padding: 40px;
        }
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        .btn-login {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 12px;
            font-weight: 600;
            transition: transform 0.2s;
        }
        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .btn-register {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border: none;
            padding: 12px;
            font-weight: 600;
            transition: transform 0.2s;
        }
        .btn-register:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
        }
        .alert-custom {
            border: none;
            border-radius: 10px;
        }
        .input-group-text {
            background: #f8f9fa;
            border-right: none;
        }
        .form-control {
            border-left: none;
        }
        .tab-content {
            margin-top: 20px;
        }
        .nav-tabs {
            border-bottom: 2px solid #e9ecef;
        }
        .nav-tabs .nav-link {
            border: none;
            color: #6c757d;
            font-weight: 500;
            padding: 10px 20px;
        }
        .nav-tabs .nav-link.active {
            color: #667eea;
            border-bottom: 3px solid #667eea;
            background: none;
        }
        .first-account-notice {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            color: #2d3436;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-header">
            <div class="icon">
                <i class="bi bi-folder-lock"></i>
            </div>
            <h2>è³‡æ–™å¤¾æ¬Šé™ç®¡ç†ç³»çµ±</h2>
            <p class="mb-0">è«‹ç™»å…¥æˆ–è¨»å†Šä»¥ç¹¼çºŒ</p>
        </div>
        
        <div class="login-body">
            <!-- é è¨­ç®¡ç†å“¡æç¤º -->
            <div class="alert alert-info alert-custom" role="alert">
                <i class="bi bi-info-circle-fill"></i>
                <strong>æç¤ºï¼š</strong>ç³»çµ±é è¨­ç®¡ç†å“¡å¸³è™Ÿç‚º <code>admin</code> / <code>admin123</code><br>
                <small class="text-muted">ä¸€èˆ¬ä½¿ç”¨è€…è¨»å†Šå¾Œéœ€ç­‰å¾…ç®¡ç†å“¡å¯©æ ¸é€šéæ‰èƒ½ç™»å…¥</small>
            </div>

            <!-- è¨Šæ¯å€åŸŸ -->
            <div id="message-area"></div>

            <!-- åˆ†é  -->
            <ul class="nav nav-tabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login-content" type="button" role="tab">
                        <i class="bi bi-box-arrow-in-right"></i> ç™»å…¥
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register-content" type="button" role="tab">
                        <i class="bi bi-person-plus"></i> è¨»å†Š
                    </button>
                </li>
            </ul>

            <div class="tab-content">
                <!-- ç™»å…¥è¡¨å–® -->
                <div class="tab-pane fade show active" id="login-content" role="tabpanel">
                    <form id="login-form">
                        <div class="mb-3">
                            <label class="form-label">ä½¿ç”¨è€…åç¨±</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="bi bi-person"></i>
                                </span>
                                <input type="text" class="form-control" name="username" placeholder="è«‹è¼¸å…¥ä½¿ç”¨è€…åç¨±" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">å¯†ç¢¼</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="bi bi-lock"></i>
                                </span>
                                <input type="password" class="form-control" name="password" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary btn-login w-100">
                            <i class="bi bi-box-arrow-in-right"></i> ç™»å…¥
                        </button>
                    </form>
                </div>

                <!-- è¨»å†Šè¡¨å–® -->
                <div class="tab-pane fade" id="register-content" role="tabpanel">
                    <form id="register-form">
                        <div class="mb-3">
                            <label class="form-label">ä½¿ç”¨è€…åç¨± <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="bi bi-person"></i>
                                </span>
                                <input type="text" class="form-control" name="username" placeholder="è«‹è¼¸å…¥ä½¿ç”¨è€…åç¨±" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">å¯†ç¢¼ <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="bi bi-lock"></i>
                                </span>
                                <input type="password" class="form-control" name="password" placeholder="è‡³å°‘ 6 å€‹å­—å…ƒ" required minlength="6">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ç¢ºèªå¯†ç¢¼ <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="bi bi-lock-fill"></i>
                                </span>
                                <input type="password" class="form-control" name="password_confirm" placeholder="è«‹å†æ¬¡è¼¸å…¥å¯†ç¢¼" required minlength="6">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">å§“åï¼ˆé¸å¡«ï¼‰</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="bi bi-card-text"></i>
                                </span>
                                <input type="text" class="form-control" name="full_name" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary btn-register w-100">
                            <i class="bi bi-person-plus"></i> è¨»å†Š
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            // ç™»å…¥è¡¨å–®æäº¤
            $('#login-form').on('submit', function(e) {
                e.preventDefault();
                
                const formData = {
                    username: $(this).find('input[name="username"]').val(),
                    password: $(this).find('input[name="password"]').val()
                };

                $.ajax({
                    url: '/api/auth/login',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(formData),
                    success: function(response) {
                        showMessage('success', 'âœ… ' + (response.message || 'ç™»å…¥æˆåŠŸï¼æ­£åœ¨è·³è½‰...'));
                        setTimeout(function() {
                            window.location.href = '/index.html';
                        }, 1000);
                    },
                    error: function(xhr) {
                        let error = xhr.responseJSON?.error || 'ç™»å…¥å¤±æ•—ï¼Œè«‹é‡è©¦';
                        let messageType = 'danger';
                        
                        // æ ¹æ“šéŒ¯èª¤è¨Šæ¯èª¿æ•´é¡¯ç¤º
                        if (error.includes('pending') || error.includes('ç­‰å¾…å¯©æ ¸') || error.includes('å¯©æ ¸ä¸­')) {
                            error = '<strong>â³ å¸³è™Ÿå¯©æ ¸ä¸­</strong><br>' +
                                   'æ‚¨çš„å¸³è™Ÿæ­£åœ¨ç­‰å¾…ç®¡ç†å“¡å¯©æ ¸ï¼Œå¯©æ ¸é€šéå¾Œå³å¯ç™»å…¥ã€‚<br>' +
                                   '<small class="text-muted">å¦‚æœ‰ç–‘å•ï¼Œè«‹è¯ç¹«ç®¡ç†å“¡</small>';
                            messageType = 'warning';
                        } else if (error.includes('rejected') || error.includes('å·²è¢«æ‹’çµ•')) {
                            error = '<strong>âŒ å¸³è™Ÿå·²è¢«æ‹’çµ•</strong><br>' +
                                   'æ‚¨çš„è¨»å†Šç”³è«‹å·²è¢«ç®¡ç†å“¡æ‹’çµ•ã€‚<br>' +
                                   '<small class="text-muted">å¦‚æœ‰ç–‘å•ï¼Œè«‹è¯ç¹«ç®¡ç†å“¡</small>';
                            messageType = 'danger';
                        } else if (error.includes('å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤')) {
                            error = '<strong>ğŸ”’ ç™»å…¥å¤±æ•—</strong><br>' +
                                   'å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥ã€‚';
                            messageType = 'danger';
                        }
                        
                        showMessage(messageType, error);
                    }
                });
            });

            // è¨»å†Šè¡¨å–®æäº¤
            $('#register-form').on('submit', function(e) {
                e.preventDefault();
                
                const password = $(this).find('input[name="password"]').val();
                const passwordConfirm = $(this).find('input[name="password_confirm"]').val();

                if (password !== passwordConfirm) {
                    showMessage('danger', 'å…©æ¬¡è¼¸å…¥çš„å¯†ç¢¼ä¸ä¸€è‡´');
                    return;
                }

                const formData = {
                    username: $(this).find('input[name="username"]').val(),
                    password: password,
                    full_name: $(this).find('input[name="full_name"]').val()
                };

                $.ajax({
                    url: '/api/auth/register',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(formData),
                    success: function(response) {
                        let message = response.message || 'è¨»å†ŠæˆåŠŸï¼';
                        let messageType = 'success';
                        
                        // æª¢æŸ¥æ˜¯å¦éœ€è¦å¯©æ ¸
                        if (response.requiresApproval) {
                            message = '<strong>ğŸ“ è¨»å†ŠæˆåŠŸï¼</strong><br>' + 
                                     'æ‚¨çš„å¸³è™Ÿæ­£åœ¨ç­‰å¾…ç®¡ç†å“¡å¯©æ ¸ï¼Œå¯©æ ¸é€šéå¾Œå³å¯ç™»å…¥ã€‚<br>' +
                                     '<small class="text-muted">è«‹ç¨å¾Œå†è©¦æˆ–è¯ç¹«ç®¡ç†å“¡</small>';
                            messageType = 'info';
                        } else if (response.isFirstAccount) {
                            // é è¨­ç®¡ç†å“¡å¸³è™Ÿï¼ˆadmin/admin123ï¼‰å·²å­˜åœ¨æ™‚ï¼Œç¬¬ä¸€å€‹è¨»å†Šçš„ä½¿ç”¨è€…ä¸æ˜¯ç®¡ç†å“¡
                            message = '<strong>âœ… è¨»å†ŠæˆåŠŸï¼</strong><br>' + 
                                     'æ‚¨çš„å¸³è™Ÿæ­£åœ¨ç­‰å¾…ç®¡ç†å“¡å¯©æ ¸ï¼Œå¯©æ ¸é€šéå¾Œå³å¯ç™»å…¥ã€‚';
                            messageType = 'info';
                        }
                        
                        showMessage(messageType, message);
                        
                        // æ¸…ç©ºè¡¨å–®
                        $('#register-form')[0].reset();
                        
                        // åˆ‡æ›åˆ°ç™»å…¥é é¢
                        setTimeout(function() {
                            $('#login-tab').click();
                        }, 3000);
                    },
                    error: function(xhr) {
                        const error = xhr.responseJSON?.error || 'è¨»å†Šå¤±æ•—ï¼Œè«‹é‡è©¦';
                        showMessage('danger', error);
                    }
                });
            });
        });

        // é¡¯ç¤ºè¨Šæ¯
        function showMessage(type, message) {
            const alertHtml = `
                <div class="alert alert-${type} alert-custom alert-dismissible fade show" role="alert">
                    <i class="bi bi-${type === 'success' ? 'check-circle-fill' : 'exclamation-triangle-fill'}"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            $('#message-area').html(alertHtml);
            
            // è‡ªå‹•æ¶ˆå¤±
            setTimeout(function() {
                $('.alert').alert('close');
            }, 5000);
        }
    </script>
</body>
</html>

